"use strict";!function(e){function t(){var e=a("fileselect");e.addEventListener("change",n,!1)}function a(e){return document.getElementById(e)}function n(e){for(var t,a=e.target.files||e.dataTransfer.files,n=0;t=a[n];n++)i(n,t)}function i(t,a){if(e.inArray(a.type,c)!==-1){var n=new FileReader;n.onload=function(e){o(a,e.target.result)},n.readAsDataURL(a)}else alert(a.type)}function o(e,t){var a=new FormData;a.append("uploadFile",e),a.append("date",(new Date).toString()),a.append("comment","test me");var n=new XMLHttpRequest;n.upload.addEventListener("progress",d,!1),n.addEventListener("load",function(a){s(a,e,t)},!1),n.open("POST","/uploadFile"),n.send(a)}function d(e){if(e.lengthComputable){Math.round(100*e.loaded/e.total)}}function s(t,a,n){d(t);var i=JSON.parse(t.target.responseText).res;"undefined"!=typeof i[0]?e("#file-list-upload").append(l(n,a.type,i[0].filename)):alert("Something went wrong on file upload of "+a.name)}function l(e,t,a){var n="",i="picture",o="";return 0===t.indexOf("image")&&(o='<img data-fcode="'+a+'" data-type="image" class="item-src" src="'+e+'"/>'),0===t.indexOf("video")&&(i="play",o='<video data-fcode="'+a+'" data-type="video" autoplay muted class="item-src" ><source src="'+e+'" type="video/mp4"></video>'),n+='<div class="panel panel-default">',n+='<div class="panel-body item-pbody">',n+='<div class="custom-desc">',n+='<div class="input-group">',n+='<span class="input-group-addon"><span class="glyphicon glyphicon-'+i+'" aria-hidden="true"></span></span>',n+='<input type="text" class="form-control message_text" placeholder="Custom text">',n+="</div>",n+="</div>",n+='<div class="media-wrap">',n+=o,n+="</div>",n+="</div>",n+="</div>"}function r(){var t=[],a=e("#hashtag").val(),n=e("#preftext").val();if(e("#file-list-upload .item-pbody").each(function(a,n){var i=e(n).find(".message_text"),o=e(n).find(".item-src"),d=i.val(),s=o.data("fcode"),l=o.data("type");t[a]={msg:d,fcode:s,type:l}}),t.length){var i={items:t,hashtag:a,preftext:n,token:Math.random(0,1e4)+"-"+Math.random(0,1888)},o=e.post("/post",{params:i});o.done(function(e){e.status&&window.location.reload(),console.log(e)})}}function p(){e("#hashtag").prop("disabled",!0);var t=e.get("/oht");t.done(function(t){t.status&&(e("#hashtag").val(e.trim(t.oht)),e("#hashtag").prop("disabled",!1))})}var c=["image/png","image/gif","image/jpeg","video/mp4","video/quicktime"];e("#upload-btn").click(function(t){e(".message_text").length?r():alert("You need to upload media!")}),window.File&&window.FileList&&window.FileReader&&t(),e("#refresh-oht").click(function(){p()}),e(window).on("load",function(){p()})}(jQuery);